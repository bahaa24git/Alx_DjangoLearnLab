<!-- blog/templates/blog/post_list.html -->
{% extends "blog/base.html" %}
{% block title %}Posts{% endblock %}
{% block content %}
<h2>{% if current_tag %}Posts tagged "{{ current_tag }}"{% else %}All Posts{% endif %}</h2>

{% if request.user.is_authenticated %}
  <p><a href="{% url 'blog:post_create' %}">+ New Post</a></p>
{% endif %}

<ul class="post-list">
  {% for post in posts %}
    <li class="post-item">
      <h3><a href="{% url 'blog:post_detail' post.pk %}">{{ post.title }}</a></h3>
      <p class="meta">by {{ post.author }} · {{ post.published_date|date:"Y-m-d H:i" }}</p>
      <p class="excerpt">{{ post.content|truncatewords:25 }}</p>

      {% with ts=post.tags.all %}
        {% if ts %}
          <p class="tags">
            Tags:
            {% for t in ts %}
              <a href="{% url 'blog:posts_by_tag' t.name %}">{{ t.name }}</a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </p>
        {% endif %}
      {% endwith %}

      {% if request.user == post.author %}
        <p>
          <a href="{% url 'blog:post_update' post.pk %}">Edit</a> ·
          <a href="{% url 'blog:post_delete' post.pk %}">Delete</a>
        </p>
      {% endif %}
    </li>
  {% empty %}
    <li>No posts found.</li>
  {% endfor %}
</ul>
{% endblock %}
